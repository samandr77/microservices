{
    "swagger": "2.0",
    "info": {
        "contact": {}
    },
    "paths": {
        "/api/code/check": {
            "post": {
                "description": "Проверка кода подтверждения для авторизации. Возвращает access token.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Проверить код подтверждения",
                "parameters": [
                    {
                        "description": "Email и код для проверки",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.CheckCodeRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Токен успешно получен",
                        "schema": {
                            "$ref": "#/definitions/api.CheckCodeResponse"
                        }
                    },
                    "401": {
                        "description": "Неверный или просроченный код",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "423": {
                        "description": "Блокировка",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "429": {
                        "description": "Слишком много попыток",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось проверить код",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/code/send": {
            "post": {
                "description": "Отправка кода подтверждения на email. Если переданы first_name и last_name - это регистрация, иначе - авторизация.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Отправить код подтверждения",
                "parameters": [
                    {
                        "description": "Email для отправки кода (и опционально имя/фамилия для регистрации)",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.SendCodeRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Код отправлен",
                        "schema": {
                            "$ref": "#/definitions/api.SendCodeResponse"
                        }
                    },
                    "400": {
                        "description": "Некорректный запрос",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "404": {
                        "description": "Пользователь не найден",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "410": {
                        "description": "Аккаунт удалён",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "423": {
                        "description": "Блокировка",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "429": {
                        "description": "Слишком много запросов",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось отправить код",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/email/update": {
            "post": {
                "description": "Обновляет email пользователя после выбора и возвращает токены авторизации",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Обновить email и авторизовать пользователя",
                "parameters": [
                    {
                        "description": "Выбранный email и идентификаторы Sber ID",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.UpdateEmailSelectionRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Успешная авторизация",
                        "schema": {
                            "$ref": "#/definitions/api.UpdateEmailSelectionResponse"
                        }
                    },
                    "400": {
                        "description": "Некорректный запрос",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "401": {
                        "description": "Сессия истекла",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "404": {
                        "description": "Пользователь не найден",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "410": {
                        "description": "Аккаунт удалён",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "423": {
                        "description": "Аккаунт заблокирован",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Внутренняя ошибка",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/health": {
            "get": {
                "description": "Проверяет, что сервер работает",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Проверка состояния сервиса",
                "responses": {
                    "200": {
                        "description": "Сервер работает!",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/api/openid/code": {
            "post": {
                "description": "Обмен кода авторизации на токены и регистрация/привязка пользователя",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Получение кода авторизации от OpenID провайдера (Sber ID)",
                "parameters": [
                    {
                        "description": "Код авторизации от Sber ID",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.OpenIDCodeRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Успешная регистрация/авторизация",
                        "schema": {
                            "$ref": "#/definitions/api.OpenIDCodeResponse"
                        }
                    },
                    "400": {
                        "description": "Некорректный запрос",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "401": {
                        "description": "Неверный код авторизации",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "410": {
                        "description": "Аккаунт удалён",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "423": {
                        "description": "Аккаунт заблокирован",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Внутренняя ошибка",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/sberid/config": {
            "get": {
                "description": "Возвращает конфигурацию для OAuth авторизации через Sber ID",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Получить конфигурацию Sber ID",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.SberIDConfigResponse"
                        }
                    }
                }
            }
        },
        "/api/token/destroy": {
            "post": {
                "description": "Удаляет refresh token пользователя, делая его сессию невалидной",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Удаление/инвалидация токена авторизации",
                "parameters": [
                    {
                        "description": "Session token (access token) для определения пользователя",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DestroyTokenRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Токен успешно удален",
                        "schema": {
                            "$ref": "#/definitions/api.DestroyTokenResponse"
                        }
                    },
                    "401": {
                        "description": "Токен невалидный",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось удалить токен",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/token/refresh": {
            "post": {
                "description": "Обновляет access token используя refresh token",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Обновление токена авторизации",
                "parameters": [
                    {
                        "description": "Refresh token для обновления",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.RefreshTokenRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Токены успешно обновлены",
                        "schema": {
                            "$ref": "#/definitions/api.RefreshTokenResponse"
                        }
                    },
                    "401": {
                        "description": "Токен обновления не передан",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось обновить токен",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/api/token/validate": {
            "post": {
                "description": "Проверка валидности access token и получение user_id",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Валидация токена авторизации",
                "parameters": [
                    {
                        "description": "Access token для валидации",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.ValidateTokenRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Токен валиден",
                        "schema": {
                            "$ref": "#/definitions/api.ValidateTokenResponse"
                        }
                    },
                    "401": {
                        "description": "Токен невалидный",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось проверить токен",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        },
        "/internal/api/token/destroy": {
            "post": {
                "description": "Internal endpoint для межсервисного взаимодействия. Удаляет все refresh токены пользователя по его ID",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "internal"
                ],
                "summary": "Удаление токенов пользователя (internal)",
                "parameters": [
                    {
                        "description": "User ID для удаления токенов",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.DestroyTokenInternalRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Токены успешно удалены",
                        "schema": {
                            "$ref": "#/definitions/api.DestroyTokenInternalResponse"
                        }
                    },
                    "400": {
                        "description": "Некорректный запрос или невалидный UUID",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    },
                    "500": {
                        "description": "Не удалось удалить токены",
                        "schema": {
                            "$ref": "#/definitions/api.ResponseError"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "api.CheckCodeRequest": {
            "type": "object",
            "properties": {
                "OTP": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                }
            }
        },
        "api.CheckCodeResponse": {
            "type": "object",
            "properties": {
                "accessToken": {
                    "type": "string"
                },
                "refreshToken": {
                    "type": "string"
                }
            }
        },
        "api.DestroyTokenInternalRequest": {
            "type": "object",
            "properties": {
                "user_id": {
                    "type": "string"
                }
            }
        },
        "api.DestroyTokenInternalResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            }
        },
        "api.DestroyTokenRequest": {
            "type": "object",
            "properties": {
                "session_token": {
                    "type": "string"
                }
            }
        },
        "api.DestroyTokenResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            }
        },
        "api.OpenIDCodeRequest": {
            "type": "object",
            "properties": {
                "code": {
                    "type": "string"
                }
            }
        },
        "api.OpenIDCodeResponse": {
            "type": "object",
            "properties": {
                "accessToken": {
                    "type": "string"
                },
                "refreshToken": {
                    "type": "string"
                }
            }
        },
        "api.RefreshTokenRequest": {
            "type": "object",
            "properties": {
                "refresh_token": {
                    "type": "string"
                }
            }
        },
        "api.RefreshTokenResponse": {
            "type": "object",
            "properties": {
                "accessToken": {
                    "type": "string"
                },
                "message": {
                    "type": "string"
                }
            }
        },
        "api.ResponseError": {
            "type": "object",
            "properties": {
                "blocked_to": {
                    "type": "string"
                },
                "message": {
                    "type": "string"
                }
            }
        },
        "api.SberIDConfigResponse": {
            "type": "object",
            "properties": {
                "base_url": {
                    "type": "string"
                },
                "client_id": {
                    "type": "string"
                },
                "redirect_uri": {
                    "type": "string"
                },
                "scope": {
                    "type": "string"
                }
            }
        },
        "api.SendCodeRequest": {
            "type": "object",
            "properties": {
                "email": {
                    "type": "string"
                },
                "first_name": {
                    "type": "string"
                },
                "last_name": {
                    "type": "string"
                },
                "newsletter_agreed": {
                    "type": "boolean"
                },
                "privacy_policy_agreed": {
                    "type": "boolean"
                },
                "public_donations_agreed": {
                    "type": "boolean"
                }
            }
        },
        "api.SendCodeResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string"
                }
            }
        },
        "api.UpdateEmailSelectionRequest": {
            "type": "object",
            "properties": {
                "email": {
                    "type": "string"
                },
                "user_id": {
                    "type": "string"
                }
            }
        },
        "api.UpdateEmailSelectionResponse": {
            "type": "object",
            "properties": {
                "accessToken": {
                    "type": "string"
                },
                "refreshToken": {
                    "type": "string"
                }
            }
        },
        "api.ValidateTokenRequest": {
            "type": "object",
            "properties": {
                "access_token": {
                    "type": "string"
                }
            }
        },
        "api.ValidateTokenResponse": {
            "type": "object",
            "properties": {
                "user_id": {
                    "type": "string"
                }
            }
        }
    }
}